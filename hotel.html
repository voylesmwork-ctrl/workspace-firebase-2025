<html>

<head>
  <link rel="stylesheet" type="text/css" href="css/styles.css" />
  <title>Make a reservation</title>
  <!-- Jquery library   ---->
  <script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc="
    crossorigin="anonymous"></script>
</head>

<body>
  <div class="message">
    <h1>Make a reservation</h1>

    <form id="hotelbook">
      <p>Name: <input type="text" name="name" /></p>
      <p>
        Check in: <input type="date" name="checkin" /> Check out:
        <input type="date" name="checkout" />
      </p>
      <p>
        Number of guest: <input type="number" name="num" min="0" max="5" />
      </p>
      <p>
        Room Type:
        <select name="room">
          <option>1 Bedroom Smaller Suite $139</option>

          <option>1 Bedroom Larger Suite $169</option>
          <option>1 Bedroom Junior Suite $289</option>
          <option>Grand Suite $289</option>
        </select>
      </p>

      <p>
        <input type="button" value="submit" id="submit" />
      </p>
      <p><input type="button" value="Sign out" id="signout" /></p>
    </form>
  </div>

  <!-- Insert this script at the bottom of the HTML, but before you use any Firebase services -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js';
    //Add Firebase products that you want to use
    import { getAuth } from 'https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js';
    import { getFirestore, collection, addDoc } from 'https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js';

    /* Change the configuration */
    const firebaseConfig = {
      apiKey: "AIzaSyA7itbGzW7aL2HVEnpJFsT_tDimmzgQ38M",
      authDomain: "cscia225-proj-1.firebaseapp.com",
      projectId: "cscia225-proj-1",
      storageBucket: "cscia225-proj-1.firebasestorage.app",
      messagingSenderId: "503825179033",
      appId: "1:503825179033:web:0a963ff20df478d833b308"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const hotelbooking = collection(db, 'hotelbooking');

    // Get a reference to the form element
      const form = document.getElementById('hotelbook');
    // Get a reference to the submit button 
      const submitButton = document.getElementById('submit');

    /**
     * Function to read form data and save to database
     */
    async  function getFormDataSubmit(event) {
      // Prevent the default button action (though not strictly necessary for an input type="button")
      event.preventDefault();
 
      // 1. Create a FormData object from the form element
      const formData = new FormData(form);

      // 2. Convert the FormData entries into a plain JavaScript object
      const dataObject = {};

      // The entries() method of FormData returns an iterator of key/value pairs
      for (const [key, value] of formData.entries()) {
        dataObject[key] = value;
      }
      console.log(dataObject);

      // 3. Save the booking to database
      const docRef = await addDoc(hotelbooking, dataObject);
      console.log("âœ… Booking saved successfully! Document ID:", docRef.id);

      // 4. Output the result (e.g., to the console)
      console.log('--- Form Data Object ---');
      console.log(dataObject);
    }

    // Add an event listener to the submit button
    submitButton.addEventListener('click', getFormDataSubmit);
  </script>
</body>

</html>